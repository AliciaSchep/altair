---
title: "Scatter Plots"
author: "Haley Jeppson"
date: "`r Sys.Date()`"
output: rmarkdown::html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This document is adapted from the [Bar Charts](https://altair-viz.github.io/gallery/index.html#bar-charts) section of the Altair Example Gallery.

Our first step is to set up our environment:

```{r}
# devtools::install_github("vegawidget/altair")
library("altair")
library("tibble")

vega_data <- import_vega_data()
```

## Anscombe's Quartet

#### Data

```{r}
glimpse(vega_data$anscombe())
```

#### Chart

```{r}
chart <- 
  alt$Chart(vega_data$anscombe())$
  mark_circle()$
  encode(
    x = alt$X("X", scale = alt$Scale(zero = FALSE)),
    y = alt$Y("Y", scale = alt$Scale(zero = FALSE)),
    column="Series"
  )$
  properties(
    width = 150,
    height = 150
  )

chart
```

## Becker's Barley Trellis Plot

#### Data

```{r}
glimpse(vega_data$barley())
```

#### Chart

```{r}
chart <- 
  alt$Chart(r_to_py(vega_data$barley()))$
  mark_point()$
  encode(
    x = alt$X("median(yield)", scale=alt$Scale(zero=FALSE)),
    y = alt$Y(
        "variety",
        sort = alt$SortField(
          field = "yield", 
          op = "median", 
          order = "descending"
        ),
        scale = alt$Scale(rangeStep = 20)
    ),
    color = "year:N",
    row = "site"
  )

chart
```

## Binned Scatterplot

#### Data

```{r}
glimpse(vega_data$movies())
```

#### Chart

```{r}
chart <- 
  alt$Chart(r_to_py(vega_data$movies()))$
  mark_circle()$
  encode(
    alt$X("IMDB_Rating:Q", bin = TRUE),
    alt$Y("Rotten_Tomatoes_Rating:Q", bin = TRUE),
    size="count(IMDB_Rating)"
  )

chart
```

## Bubble Plot

#### Data

```{r}
glimpse(vega_data$cars())
```

#### Chart

```{r}
chart <- 
  alt$Chart(r_to_py(vega_data$cars()))$
  mark_point()$
  encode(
    x = "Horsepower:Q",
    y = "Miles_per_Gallon:Q",
    size = "Acceleration"
  )

chart
```

## Connected Scatterplot (Lines with Custom Paths)

#### Data

```{r}
glimpse(vega_data$driving())
```

#### Chart

```{r}
lines <- 
  alt$Chart(r_to_py(vega_data$driving()))$
  mark_line()$
  encode(
    x = alt$X("miles", scale = alt$Scale(zero = FALSE)),
    y = alt$Y("gas", scale = alt$Scale(zero = FALSE)),
    order="year"
  )

points <- 
  alt$Chart(driving)$
  mark_circle()$
  encode(
    alt$X("miles", scale = alt$Scale(zero = FALSE)),
    alt$Y("gas", scale = alt$Scale(zero = FALSE))
  )

chart <- (lines + points)

chart
```

## Dot Dash Plot

#### Data

```{r}
glimpse(vega_data$cars())
```

#### Chart

```{r}
cars <- r_to_py(vega_data$cars())

brush <- alt$selection(type = "interval")

tick_axis <- alt$Axis(labels=FALSE, domain=FALSE, ticks=FALSE)

tick_axis_notitle <- 
  alt$Axis(labels=FALSE, domain=FALSE, ticks=FALSE, title="")

points <-
  alt$Chart(cars)$
  mark_point()$
  encode(
    x = alt$X("Miles_per_Gallon", axis = alt$Axis(title = "")),
    y = alt$Y("Horsepower", axis = alt$Axis(title = "")),
    color = alt$condition(brush, "Origin", alt$value("grey"))
  )$
  properties(selection = brush)

x_ticks <- 
  alt$Chart(cars)$
  mark_tick()$
  encode(
    x = alt$X("Miles_per_Gallon", axis = tick_axis),
    y = alt$Y("Origin", axis = tick_axis_notitle),
    color = alt$condition(brush, "Origin", alt$value("lightgrey"))
  )$
  properties(selection = brush)

y_ticks <- 
  alt$Chart(cars)$
  mark_tick()$
  encode(
    alt$X("Origin", axis = tick_axis_notitle),
    alt$Y("Horsepower", axis = tick_axis),
    color=alt$condition(brush, "Origin", alt$value("lightgrey"))
  )$
  properties(selection = brush)

chart <- (y_ticks | (points & x_ticks))

chart
```
#### Gapminder Bubble Plot

#### Data

```{r}
gapminder <- vega_data$gapminder()

glimpse(gapminder)
```

#### Chart

```{r}
plot <- 
  alt$Chart(r_to_py(gapminder))$
  mark_circle()$
  encode(
    alt$X("income:Q", scale = alt$Scale(type = "log")), 
    alt$Y("health:Q", scale = alt$Scale(zero = FALSE)), 
    size="population:Q"
  )

vegalite(plot)
```

#### Multifeature Scatter Plot

#### Data

```{r}
glimpse(vega_data$iris())
```

#### Chart

```{r}
chart <- 
  alt$Chart(r_to_py(vega_data$iris()))$
  mark_circle()$
  encode(
    x = alt$X("sepalLength", scale = alt$Scale(zero = FALSE)),
    y = alt$Y("sepalWidth", scale = alt$Scale(zero = FALSE, padding = 1)),
    color = "species",
    size = "petalWidth"
  )

chart
```

## Natural Disasters

#### Data

```{r}
glimpse(vega_data$disasters())
```

#### Chart

```{r}
chart <- 
  alt$Chart(r_to_py(vega_data$disasters()))$
  mark_circle(opacity = 0.8, stroke = "black", strokeWidth = 1)$
  encode(
    x = alt$X("Year:O", axis = alt$Axis(labelAngle = 0)),
    y = alt$Y("Entity:N"),
    size = alt$Size(
      "Deaths:Q",
      scale = alt$Scale(range = c(0, 5000)),
      legend = alt$Legend(title = "Annual Global Deaths")
    ),
    color = alt$Color("Entity:N", legend = NULL)
   )$
  properties(
    width = 480,
    height = 350
  )$
  transform_filter("datum.Entity != 'All natural disasters'")

chart
```

## Polynomial Fit Plot



## Scatter Matrix

#### Data

```{r}
glimpse(vega_data$cars())
```

#### Chart

```{r}
chart <- 
  alt$Chart(r_to_py(vega_data$cars()))$
  mark_circle()$
  encode(
    x = alt$X(alt$`repeat`("column"), type = "quantitative"),
    y = alt$Y(alt$`repeat`("row"), type = "quantitative"),
    color = "Origin:N"
  )$properties(
      width=250,
      height=250
  )$`repeat`(
      row=list("Horsepower", "Acceleration", "Miles_per_Gallon"),
      column=list("Miles_per_Gallon", "Acceleration", "Horsepower")
  )$interactive()

chart
```

## Simple Scatter Plot with Labels

Layering can now work with the `+` operator as it does in Python. Additionally, it can be declared as `alt$layer(chart1, chart2)` or as `alt$ChartLayer(layer = list(chart1, chart2))`

#### Data

<details>
<summary>Definition</summary>
```{r}
data <- 
  data_frame(
    x = c(1, 3, 5, 7, 9),
    y = c(1, 3, 5, 7, 9),
    label = c("A", "B", "C", "D", "E")
  )
```
</details>

```{r}
glimpse(data)
```

#### Chart

```{r}
bars <- 
  alt$Chart(r_to_py(data))$
  mark_point()$
  encode(
    x = "x:Q",
    y = "y:Q"
  )

text <-
  bars$
  mark_text(align = "left", baseline = "middle", dx = 7)$
  encode(text = "label:N")

chart <- (text + bars)

chart
```

## Table Bubble Plot (Github Punch Card)

#### Data

```{r}
glimpse(vega_data$github())
```

#### Chart

```{r}
chart <- 
  alt$Chart(r_to_py(vega_data$github()))$
  mark_circle()$
  encode(
    x = alt$X("time:O", timeUnit = "hours"),
    y = alt$Y("time:O", timeUnit = "day"),
    size = "sum(count):Q"
  )

chart
```

## Trellis Scatter Plot

#### Data

```{r}
glimpse(vega_data$movies())
```

#### Chart

```{r}
chart <- 
  alt$Chart(r_to_py(vega_data$movies()))$
  mark_point()$
  encode(
    x = "Worldwide_Gross:Q",
    y = "US_DVD_Sales:Q",
    column = "MPAA_Rating:N"
  )

chart
```








