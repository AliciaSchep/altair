---
title: "Vega Datasets"
date: "`r Sys.Date()`"
output: rmarkdown::html_document
editor_options:
  chunk_output_type: inline
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

The purpose of this article is to demonstrate the use of data provided by the [Vega datasets](https://github.com/altair-viz/vega_datasets) Python package.

Here's the short version:

- We can access the Vega datasets using the `import_vega_data()` function. This packge's convention is to assign this to an object named `vega_data`.

- To access the data for a specific dataset, call the method for that dataset: e.g. `vega_data$cars()`. Where you see a hyphen in a dataset name in the Altair documentation, use an underscore instead, e.g. `vega_data$sf_temps()`.

- These datasets have metadata that include a description, references, and a URL: e.g. `vega_data$cars$references`.

- When you create an `alt$Chart()`, the `data` argument need not be a data frame; it can be a reference to a data frame, such as a URL. In this case, you do not need to use the `r_to_py()` helper; instead you can write `alt$Chart(vega_data$cars$url)`. 

  - If your chart contains a reference to an external resource, such as `vega_data$cars$url`, it will not render in the RStudio IDE due to RStudio's (well founded) security policy. If you view such a chart using an external browser, it *should* work OK.

## Importing

In the [Altair documentation](https://altair-viz.github.io/getting_started/installation.html), you will see this code used often:

```python 
from vega_datasets import data

cars = data.cars()
```

The convention in the Altair documentation is to use the name `data` to refer to the `data` object in the `vega_datasets` package. This package offers a similar convention:

```{r r-vega-data}
library("altair")

vega_data <- import_vega_data()

cars <- vega_data$cars()
```

## Accessing

Our `vega_data` object has method to list all its datasets:

```{r list-datasets}
vega_data$list_datasets() %>% head()
```

Each dataset has accessed using a function with a name being an element returned from `list_datasets()`. 

```{r anscome}
library("tibble")

vega_data$anscombe() %>% as_tibble()
```

It is useful to keep in mind that **reticulate** changes the names of the datasets, and presumably, Python objects in general. Where you see a `-` in a name of a Python object, a `_` will be used in the name of the reticulated object in R. For example, in Python: `data.sf-temps()`; in R:

```{r r-sf-temps}
vega_data$sf_temps() %>% as_tibble()
```

## Metadata

Each dataset has some metadata associated:

```{r anscome-description}
vega_data$anscombe$description
```

```{r anscome-is_local}
vega_data$anscombe$is_local
```

```{r}
vega_data$anscombe$references
```

## Using reference to data

You can specify a dataset using a URL that points to a dataset, rather than a data frame. The `vega_data` object (assigned using `import_vega_data()`) contains the URLs as well as access to the data frames. 

```{r}
iris_url <- vega_data$iris$url

chart_iris <- 
  alt$Chart(iris_url)$
  encode(
    x = "sepalWidth:Q",
    y = "sepalLength:Q",
    color = "species:N"
  )$
  mark_point()

chart_iris
```

This works in your browser, but not in the RStudio IDE. This is because, for security reasons, the RStudioIDE does not let you refer external URLs that are not on their whitelist (such as YouTube and Vimeo). If you open this up in a browser, it works just fine (as long as you have access to the internet).
